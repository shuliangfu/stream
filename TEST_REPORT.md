# @dreamer/stream æµ‹è¯•æŠ¥å‘Š

## ğŸ“Š æµ‹è¯•æ¦‚è§ˆ

- **æµ‹è¯•åº“ç‰ˆæœ¬**: @dreamer/test@^1.0.0-beta.39
- **è¿è¡Œæ—¶é€‚é…å™¨ç‰ˆæœ¬**: @dreamer/runtime-adapter@^1.0.0-beta.20
- **æµ‹è¯•æ¡†æ¶**: @dreamer/testï¼ˆå…¼å®¹ Deno å’Œ Bunï¼‰
- **æµ‹è¯•æ—¶é—´**: 2026-01-29
- **æµ‹è¯•æ€»æ•°**: 184 ä¸ªæµ‹è¯•
- **é€šè¿‡æ•°é‡**: 184 ä¸ª âœ…
- **å¤±è´¥æ•°é‡**: 0 ä¸ª
- **æµ‹è¯•æ–‡ä»¶æ•°**: 21 ä¸ª
- **æµ‹è¯•æ‰§è¡Œæ—¶é—´**: çº¦ 7â€“19 ç§’ï¼ˆè§†ç¯å¢ƒè€Œå®šï¼‰
- **æµ‹è¯•çŠ¶æ€**: âœ… **å…¨éƒ¨é€šè¿‡**

---

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•

#### 1. æµç®¡ç†å™¨ (`manager.test.ts`) - 15 ä¸ªæµ‹è¯•
- âœ… **æµç®¡ç†**
  - `createStream` - åˆ›å»ºæµ
  - `getStream` - è·å–æµ
  - `deleteStream` - åˆ é™¤æµ
  - `listStreams` - åˆ—å‡ºæ‰€æœ‰æµ
- âœ… **æˆ¿é—´ç®¡ç†**
  - `createRoom` - åˆ›å»ºæˆ¿é—´
  - `getRoom` - è·å–æˆ¿é—´
  - `deleteRoom` - åˆ é™¤æˆ¿é—´
  - `listRooms` - åˆ—å‡ºæ‰€æœ‰æˆ¿é—´
- âœ… **ç»Ÿè®¡ä¿¡æ¯**
  - `getStatistics` - è·å–ç»Ÿè®¡ä¿¡æ¯
- âœ… **é”™è¯¯å¤„ç†**
  - ä¸æ”¯æŒé€‚é…å™¨ç±»å‹çš„é”™è¯¯å¤„ç†
- âœ… **åˆ—è¡¨è¿‡æ»¤**
  - `listStreams` æ”¯æŒ filterï¼ˆnameã€roomIdã€statusã€protocolï¼‰
  - `listRooms` æ”¯æŒ filterï¼ˆnameã€isPrivateï¼‰
- âœ… **é€‚é…å™¨**
  - nginx-rtmp é€‚é…å™¨ï¼ˆmock statï¼‰
  - livekit é€‚é…å™¨ï¼ˆmock APIï¼‰

**æµ‹è¯•ç»“æœ**: 15 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

#### 2. é€‚é…å™¨æµ‹è¯• (`adapters/ffmpeg.test.ts`) - 10 ä¸ªæµ‹è¯•
- âœ… **FFmpeg é€‚é…å™¨**
  - åˆ›å»ºé€‚é…å™¨å®ä¾‹
  - åˆ›å»ºæµ
  - è·å–æµ
  - å¤„ç†ä¸å­˜åœ¨çš„æµ
  - åˆ é™¤æµ
  - åˆ—å‡ºæ‰€æœ‰æµ
  - æ”¯æŒåˆ†é¡µåˆ—å‡ºæµ
  - è·å–ç»Ÿè®¡ä¿¡æ¯
  - æ”¯æŒæ¸…ç†æ“ä½œ

**æµ‹è¯•ç»“æœ**: 10 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

#### 3. SRS é€‚é…å™¨æµ‹è¯• (`adapters/srs.test.ts`) - 12 ä¸ªæµ‹è¯•
- âœ… **SRS é€‚é…å™¨**ï¼ˆmock fetchï¼Œæ— éœ€çœŸå® SRS æœåŠ¡å™¨ï¼‰
  - åˆ›å»ºé€‚é…å™¨å®ä¾‹ã€é»˜è®¤é…ç½®
  - åˆ›å»ºæµã€è·å–æµã€ä¸å­˜åœ¨çš„æµè¿”å› null
  - åˆ—å‡ºæ‰€æœ‰æµã€åˆ†é¡µï¼ˆlimit/offsetï¼‰
  - åˆ é™¤æµã€è·å–ç»Ÿè®¡ä¿¡æ¯
  - getStatistics å¯¹ä¸å­˜åœ¨çš„æµæŠ›å‡º StreamNotFoundError
  - connect æˆåŠŸ/å¤±è´¥

**æµ‹è¯•ç»“æœ**: 12 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

#### 4. nginx-rtmp é€‚é…å™¨æµ‹è¯• (`adapters/nginx-rtmp.test.ts`) - 13 ä¸ªæµ‹è¯•
- âœ… **NginxRtmpAdapter**ï¼ˆmock fetch /statï¼‰
  - åˆ›å»ºé€‚é…å™¨å®ä¾‹ã€é»˜è®¤é…ç½®
  - createStream ç™»è®°æµå¹¶è¿”å›æ¨æ‹‰ URL
  - getStream ä» stat åŒæ­¥åœ¨æ’­æµã€æœ¬åœ°å·²ç™»è®°æµ
  - listStreams åˆå¹¶ stat ä¸æœ¬åœ°æµ
  - deleteStreamã€getStatisticsã€connect å¤±è´¥ã€createPublisher/createSubscriber

**æµ‹è¯•ç»“æœ**: 13 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

#### 5. LiveKit é€‚é…å™¨æµ‹è¯• (`adapters/livekit.test.ts`) - 11 ä¸ªæµ‹è¯•
- âœ… **LiveKitAdapter**ï¼ˆmock fetch RoomService APIï¼‰
  - åˆ›å»ºé€‚é…å™¨å®ä¾‹ã€é»˜è®¤ host
  - createStream è°ƒç”¨ CreateRoom
  - getStream/listStreams/deleteStream/getStatistics
  - createPublisher/createSubscriberã€StreamNotFoundError

**æµ‹è¯•ç»“æœ**: 11 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

#### 6. å®¢æˆ·ç«¯æµè§ˆå™¨æµ‹è¯• (`client/browser-client.test.ts`) - 9 ä¸ªæµ‹è¯•
- âœ… **Stream å®¢æˆ·ç«¯ - æµè§ˆå™¨æµ‹è¯•**ï¼ˆ@dreamer/test æµè§ˆå™¨é›†æˆï¼ŒPuppeteer + esbuildï¼‰
  - StreamClient æŒ‚è½½åŠ ClientPublisherã€ClientSubscriber å¯¼å‡º
  - ClientPublisher å®ä¾‹ä¸æ–¹æ³•ï¼ˆconnectã€publishã€stopã€onã€offã€getStatisticsï¼‰
  - ClientSubscriber å®ä¾‹ä¸æ–¹æ³•ï¼ˆconnectã€subscribeã€stopã€playã€pauseã€onã€offã€getStatisticsï¼‰
  - äº‹ä»¶ on/offã€getStatistics è¿”å›å¯¹è±¡
  - MediaStream / HTMLVideoElement ç¯å¢ƒæ£€æµ‹

**æµ‹è¯•ç»“æœ**: 9 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

#### 7. æœåŠ¡ç«¯æ¨æ‹‰æµæµ‹è¯• (`server/publisher.test.ts`, `server/subscriber.test.ts`) - 16 ä¸ªæµ‹è¯•
- âœ… **ServerPublisher**
  - åˆ›å»ºå®ä¾‹ã€getStatisticsï¼ˆidleï¼‰ã€connect åçŠ¶æ€ä¸º connected
  - æœªè¿æ¥æ—¶ publish æŠ›å‡ºã€é‡å¤ connect æŠ›å‡ºã€on/off äº‹ä»¶
  - getHlsPlaylistPath åœ¨é HLS æ¨æµæ—¶è¿”å› undefined
  - publish ä½¿ç”¨ WebRTC URL æˆ–é Blob/é string åª’ä½“æºæ—¶æŠ›å‡ºæ˜ç¡®é”™è¯¯
- âœ… **ServerSubscriber**
  - åˆ›å»ºå®ä¾‹ã€getStatisticsï¼ˆidleï¼‰ã€connect åçŠ¶æ€ä¸º connected
  - æœªè¿æ¥æ—¶ subscribe æŠ›å‡ºã€é‡å¤ connect æŠ›å‡ºã€on/off äº‹ä»¶

**æµ‹è¯•ç»“æœ**: 16 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

#### é›†æˆæµ‹è¯• (`integration/`)

**æµç”Ÿå‘½å‘¨æœŸæµ‹è¯•** (`stream-lifecycle.test.ts`)
- âœ… å®Œæˆæµçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
- âœ… æ”¯æŒæˆ¿é—´å’Œæµå…³è”
- âœ… æ”¯æŒæ‰¹é‡æ“ä½œæµ

**æµ‹è¯•ç»“æœ**: 3 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

**è§†é¢‘æ–‡ä»¶æ¨æµæµ‹è¯•** (`video-file-publish.test.ts`)
- âœ… èƒ½å¤Ÿä½¿ç”¨è§†é¢‘æ–‡ä»¶è¿›è¡Œæ¨æµ
- âœ… æ”¯æŒå¾ªç¯æ’­æ”¾è§†é¢‘æ–‡ä»¶
- âœ… èƒ½å¤Ÿè®¾ç½®è§†é¢‘è´¨é‡
- âœ… åœ¨ä¸å­˜åœ¨çš„è§†é¢‘æ–‡ä»¶æ—¶æŠ›å‡ºé”™è¯¯

**æµ‹è¯•ç»“æœ**: 4 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## ğŸ› ï¸ å·¥å…·å‡½æ•°æµ‹è¯•

### é”™è¯¯å¤„ç† (`utils/errors.test.ts`)
- âœ… **é”™è¯¯ç±»**
  - `StreamError` - åŸºç¡€é”™è¯¯ç±»
  - `StreamNotFoundError` - æµä¸å­˜åœ¨é”™è¯¯
  - `StreamAlreadyExistsError` - æµå·²å­˜åœ¨é”™è¯¯
  - `PublisherStateError` - æ¨æµå™¨çŠ¶æ€é”™è¯¯
  - `SubscriberStateError` - æ‹‰æµå™¨çŠ¶æ€é”™è¯¯
  - `ConnectionError` - è¿æ¥é”™è¯¯
  - `ProtocolNotSupportedError` - åè®®ä¸æ”¯æŒé”™è¯¯
  - `AdapterError` - é€‚é…å™¨é”™è¯¯
  - `ConfigurationError` - é…ç½®é”™è¯¯

**æµ‹è¯•ç»“æœ**: 11 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### åè®®å¤„ç† (`utils/protocol.test.ts`)
- âœ… **åè®®æ£€æµ‹**
  - `detectProtocol` - æ£€æµ‹ RTMPã€HLSã€FLVã€WebRTCã€DASH åè®®
  - `clearProtocolCache` - æ¸…ç†åè®®æ£€æµ‹ç¼“å­˜
- âœ… **åè®®éªŒè¯**
  - `validateProtocol` - éªŒè¯æœ‰æ•ˆåè®®
  - å¯¹æ— æ•ˆåè®®æŠ›å‡ºé”™è¯¯
- âœ… **URL è§£æ**
  - `parseRtmpUrl` - è§£æ RTMP URL
  - `parseHlsUrl` - è§£æ HLS URL
- âœ… **åè®®å·¥å…·**
  - `getDefaultPort` - è·å–é»˜è®¤ç«¯å£ï¼ˆRTMPã€HLSã€WebRTCï¼‰
  - `supportsPublishing` - åˆ¤æ–­åè®®æ˜¯å¦æ”¯æŒæ¨æµ
  - `supportsSubscribing` - åˆ¤æ–­åè®®æ˜¯å¦æ”¯æŒæ‹‰æµ

**æµ‹è¯•ç»“æœ**: 17 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### URL ç”Ÿæˆ (`utils/url.test.ts`)
- âœ… **URL ç”Ÿæˆ**
  - `generateRtmpUrl` - ç”Ÿæˆ RTMP URL
  - `generateHlsUrl` - ç”Ÿæˆ HLS URL
  - `generateFlvUrl` - ç”Ÿæˆ FLV URL
  - `generateWebRtcUrl` - ç”Ÿæˆ WebRTC URL
  - `generatePublisherUrl` - ç”Ÿæˆæ¨æµ URLï¼ˆRTMPã€WebRTCï¼‰
  - `generateSubscriberUrl` - ç”Ÿæˆæ‹‰æµ URLï¼ˆHLSã€FLVï¼‰

**æµ‹è¯•ç»“æœ**: 8 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### çŠ¶æ€ç®¡ç† (`utils/state.test.ts`)
- âœ… **çŠ¶æ€è½¬æ¢éªŒè¯**
  - `isValidStreamTransition` - éªŒè¯æœ‰æ•ˆçš„æµçŠ¶æ€è½¬æ¢
  - `isValidPublisherTransition` - éªŒè¯æœ‰æ•ˆçš„æ¨æµå™¨çŠ¶æ€è½¬æ¢
  - `isValidSubscriberTransition` - éªŒè¯æœ‰æ•ˆçš„æ‹‰æµå™¨çŠ¶æ€è½¬æ¢
  - æ‹’ç»æ— æ•ˆçš„çŠ¶æ€è½¬æ¢
- âœ… **çŠ¶æ€å·¥å…·**
  - `getStreamStatusName` - è¿”å›æµçŠ¶æ€çš„æ˜¾ç¤ºåç§°
  - `getPublisherStatusName` - è¿”å›æ¨æµå™¨çŠ¶æ€çš„æ˜¾ç¤ºåç§°
  - `getSubscriberStatusName` - è¿”å›æ‹‰æµå™¨çŠ¶æ€çš„æ˜¾ç¤ºåç§°
  - `isActiveStatus` - åˆ¤æ–­æµçŠ¶æ€æ˜¯å¦ä¸ºæ´»åŠ¨çŠ¶æ€
  - `isErrorStatus` - åˆ¤æ–­çŠ¶æ€æ˜¯å¦ä¸ºé”™è¯¯çŠ¶æ€

**æµ‹è¯•ç»“æœ**: 11 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### ID ç”Ÿæˆ (`utils/id.test.ts`)
- âœ… **ID ç”Ÿæˆ**
  - `generateId` - ç”Ÿæˆå¸¦å‰ç¼€çš„ ID
  - `generateId` - ç”Ÿæˆå”¯ä¸€çš„ ID
  - `generateStreamId` - ç”Ÿæˆæµ ID
  - `generateRoomId` - ç”Ÿæˆæˆ¿é—´ ID
  - ç”Ÿæˆä¸åŒå‰ç¼€çš„ ID

**æµ‹è¯•ç»“æœ**: 5 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### ç¼“å­˜ (`utils/cache.test.ts`)
- âœ… **LRU ç¼“å­˜**
  - æ”¯æŒåŸºæœ¬æ“ä½œï¼ˆgetã€setã€deleteï¼‰
  - å®ç° LRU æ·˜æ±°ç­–ç•¥
  - æ›´æ–°è®¿é—®é¡ºåº
  - æ”¯æŒ TTL è¿‡æœŸ
  - æ›´æ–°å·²å­˜åœ¨çš„å€¼
  - æ”¯æŒåˆ é™¤æ“ä½œ
  - æ”¯æŒæ¸…ç©ºæ“ä½œ
  - æ”¯æŒ has æ–¹æ³•
  - æ”¯æŒæ¸…ç†è¿‡æœŸé¡¹

**æµ‹è¯•ç»“æœ**: 9 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### æµç¼“å­˜ (`utils/stream-cache.test.ts`)
- âœ… **æµä¿¡æ¯ç¼“å­˜**
  - æ”¯æŒåŸºæœ¬æ“ä½œ
  - ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
  - æ”¯æŒåˆ é™¤æµ
  - æ”¯æŒ needsUpdate æ£€æŸ¥
  - æ”¯æŒæ¸…ç©ºæ“ä½œ
  - æä¾›ç»Ÿè®¡ä¿¡æ¯

**æµ‹è¯•ç»“æœ**: 6 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### æ•°æ®é˜Ÿåˆ— (`utils/queue.test.ts`)
- âœ… **æ•°æ®é˜Ÿåˆ—**
  - æ”¯æŒåŸºæœ¬æ“ä½œï¼ˆenqueueã€dequeueï¼‰
  - æ”¯æŒæ‰¹é‡å‡ºé˜Ÿ
  - é™åˆ¶é˜Ÿåˆ—å¤§å°
  - æ­£ç¡®åˆ¤æ–­ isEmpty å’Œ isFull
  - æ”¯æŒæ¸…ç©ºæ“ä½œ
  - æ”¯æŒè‡ªåŠ¨å¤„ç†

**æµ‹è¯•ç»“æœ**: 6 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### è¿æ¥æ±  (`utils/connection-pool.test.ts`)
- âœ… **è¿æ¥æ± ç®¡ç†**
  - æ”¯æŒåŸºæœ¬æ“ä½œ
  - å¤ç”¨è¿æ¥
  - é™åˆ¶è¿æ¥æ•°
  - æ”¯æŒé‡Šæ”¾è¿æ¥
  - æä¾›ç»Ÿè®¡ä¿¡æ¯
  - åœ¨ stop æ—¶æ¸…ç†æ‰€æœ‰è¿æ¥

**æµ‹è¯•ç»“æœ**: 6 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### é‡è¿ç®¡ç† (`utils/reconnect.test.ts`)
- âœ… **é‡è¿ç®¡ç†å™¨**
  - æ”¯æŒåŸºæœ¬é‡è¿æ“ä½œ
  - åœ¨è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°æ—¶æŠ›å‡ºé”™è¯¯
  - å®ç°æŒ‡æ•°é€€é¿
  - æ”¯æŒé‡ç½®æ“ä½œ
  - æ”¯æŒåœæ­¢æ“ä½œ

**æµ‹è¯•ç»“æœ**: 5 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### æ‰¹é‡æ“ä½œ (`utils/batch-operations.test.ts`)
- âœ… **æ‰¹é‡å¤„ç†**
  - `batchProcess` - æ”¯æŒåŸºæœ¬æ‰¹é‡å¤„ç†
  - `batchProcess` - æ”¯æŒé”™è¯¯å¤„ç†
  - `batchProcess` - åœ¨ä¸ç»§ç»­é”™è¯¯æ—¶æŠ›å‡ºå¼‚å¸¸
  - `batchProcess` - æ§åˆ¶å¹¶å‘æ•°
  - `batchCreateStreams` - æ‰¹é‡åˆ›å»ºæµ
  - `batchDeleteStreams` - æ‰¹é‡åˆ é™¤æµ
  - `batchGetStreams` - æ‰¹é‡è·å–æµ

**æµ‹è¯•ç»“æœ**: 7 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## ğŸ“‹ æµ‹è¯•æ–‡ä»¶ç»Ÿè®¡

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•æ•° | çŠ¶æ€ | è¯´æ˜ |
|---------|--------|------|------|
| `manager.test.ts` | 15 | âœ… å…¨éƒ¨é€šè¿‡ | æµç®¡ç†å™¨æµ‹è¯• |
| `adapters/ffmpeg.test.ts` | 10 | âœ… å…¨éƒ¨é€šè¿‡ | FFmpeg é€‚é…å™¨æµ‹è¯• |
| `adapters/srs.test.ts` | 12 | âœ… å…¨éƒ¨é€šè¿‡ | SRS é€‚é…å™¨æµ‹è¯• |
| `adapters/nginx-rtmp.test.ts` | 13 | âœ… å…¨éƒ¨é€šè¿‡ | nginx-rtmp é€‚é…å™¨æµ‹è¯• |
| `adapters/livekit.test.ts` | 11 | âœ… å…¨éƒ¨é€šè¿‡ | LiveKit é€‚é…å™¨æµ‹è¯• |
| `client/browser-client.test.ts` | 9 | âœ… å…¨éƒ¨é€šè¿‡ | æµè§ˆå™¨å®¢æˆ·ç«¯æµ‹è¯• |
| `server/publisher.test.ts` | 10 | âœ… å…¨éƒ¨é€šè¿‡ | æœåŠ¡ç«¯æ¨æµå™¨æµ‹è¯• |
| `server/subscriber.test.ts` | 6 | âœ… å…¨éƒ¨é€šè¿‡ | æœåŠ¡ç«¯æ‹‰æµå™¨æµ‹è¯• |
| `integration/stream-lifecycle.test.ts` | 3 | âœ… å…¨éƒ¨é€šè¿‡ | æµç”Ÿå‘½å‘¨æœŸé›†æˆæµ‹è¯• |
| `integration/video-file-publish.test.ts` | 4 | âœ… å…¨éƒ¨é€šè¿‡ | è§†é¢‘æ–‡ä»¶æ¨æµé›†æˆæµ‹è¯• |
| `utils/errors.test.ts` | 11 | âœ… å…¨éƒ¨é€šè¿‡ | é”™è¯¯ç±»æµ‹è¯• |
| `utils/protocol.test.ts` | 17 | âœ… å…¨éƒ¨é€šè¿‡ | åè®®å¤„ç†æµ‹è¯• |
| `utils/url.test.ts` | 8 | âœ… å…¨éƒ¨é€šè¿‡ | URL ç”Ÿæˆæµ‹è¯• |
| `utils/state.test.ts` | 11 | âœ… å…¨éƒ¨é€šè¿‡ | çŠ¶æ€ç®¡ç†æµ‹è¯• |
| `utils/id.test.ts` | 5 | âœ… å…¨éƒ¨é€šè¿‡ | ID ç”Ÿæˆå™¨æµ‹è¯• |
| `utils/cache.test.ts` | 9 | âœ… å…¨éƒ¨é€šè¿‡ | LRU ç¼“å­˜æµ‹è¯• |
| `utils/stream-cache.test.ts` | 6 | âœ… å…¨éƒ¨é€šè¿‡ | æµç¼“å­˜æµ‹è¯• |
| `utils/queue.test.ts` | 6 | âœ… å…¨éƒ¨é€šè¿‡ | æ•°æ®é˜Ÿåˆ—æµ‹è¯• |
| `utils/connection-pool.test.ts` | 6 | âœ… å…¨éƒ¨é€šè¿‡ | è¿æ¥æ± æµ‹è¯• |
| `utils/reconnect.test.ts` | 5 | âœ… å…¨éƒ¨é€šè¿‡ | é‡è¿ç®¡ç†å™¨æµ‹è¯• |
| `utils/batch-operations.test.ts` | 7 | âœ… å…¨éƒ¨é€šè¿‡ | æ‰¹é‡æ“ä½œå·¥å…·æµ‹è¯• |

---

## ğŸ” åŠŸèƒ½æµ‹è¯•è¯¦æƒ…

### 1. æµç®¡ç†å™¨ (`manager.test.ts`) - 15 ä¸ªæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- âœ… åˆ›å»ºç®¡ç†å™¨å®ä¾‹
- âœ… åˆ›å»ºæµï¼ˆæ”¯æŒ RTMPã€HLSã€WebRTC ç­‰åè®®ï¼‰
- âœ… è·å–æµï¼ˆé€šè¿‡ IDï¼‰
- âœ… åˆ é™¤æµ
- âœ… åˆ—å‡ºæ‰€æœ‰æµ
- âœ… åˆ›å»ºæˆ¿é—´
- âœ… è·å–æˆ¿é—´
- âœ… åˆ é™¤æˆ¿é—´
- âœ… åˆ—å‡ºæ‰€æœ‰æˆ¿é—´
- âœ… è·å–ç»Ÿè®¡ä¿¡æ¯
- âœ… å¯¹ä¸æ”¯æŒçš„é€‚é…å™¨ç±»å‹æŠ›å‡ºé”™è¯¯
- âœ… åˆ—è¡¨è¿‡æ»¤ï¼ˆlistStreams / listRooms filterï¼‰
- âœ… é€‚é…å™¨ï¼ˆnginx-rtmpã€livekit mockï¼‰

**æµ‹è¯•ç»“æœ**: 15 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### 2. FFmpeg é€‚é…å™¨ (`adapters/ffmpeg.test.ts`) - 10 ä¸ªæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- âœ… åˆ›å»ºé€‚é…å™¨å®ä¾‹
- âœ… åˆ›å»ºæµ
- âœ… è·å–æµ
- âœ… è¿”å› null å½“æµä¸å­˜åœ¨æ—¶
- âœ… åˆ é™¤æµ
- âœ… å¤„ç†åˆ é™¤ä¸å­˜åœ¨çš„æµ
- âœ… åˆ—å‡ºæ‰€æœ‰æµ
- âœ… æ”¯æŒåˆ†é¡µåˆ—å‡ºæµ
- âœ… è·å–ç»Ÿè®¡ä¿¡æ¯
- âœ… æ”¯æŒæ¸…ç†æ“ä½œ

**æµ‹è¯•ç»“æœ**: 10 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### 3. æµç”Ÿå‘½å‘¨æœŸé›†æˆæµ‹è¯• (`integration/stream-lifecycle.test.ts`) - 3 ä¸ªæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- âœ… å®Œæˆæµçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼ˆåˆ›å»º â†’ ä½¿ç”¨ â†’ åˆ é™¤ï¼‰
- âœ… æ”¯æŒæˆ¿é—´å’Œæµå…³è”
- âœ… æ”¯æŒæ‰¹é‡æ“ä½œæµ

**æµ‹è¯•ç»“æœ**: 3 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### 4. è§†é¢‘æ–‡ä»¶æ¨æµé›†æˆæµ‹è¯• (`integration/video-file-publish.test.ts`) - 4 ä¸ªæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- âœ… èƒ½å¤Ÿä½¿ç”¨è§†é¢‘æ–‡ä»¶è¿›è¡Œæ¨æµ
- âœ… æ”¯æŒå¾ªç¯æ’­æ”¾è§†é¢‘æ–‡ä»¶
- âœ… èƒ½å¤Ÿè®¾ç½®è§†é¢‘è´¨é‡ï¼ˆåˆ†è¾¨ç‡ã€ç ç‡ã€å¸§ç‡ï¼‰
- âœ… åœ¨ä¸å­˜åœ¨çš„è§†é¢‘æ–‡ä»¶æ—¶æŠ›å‡ºé”™è¯¯

**æµ‹è¯•ç»“æœ**: 4 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

**æ³¨æ„äº‹é¡¹**:
- è¿™äº›æµ‹è¯•éœ€è¦ SRS Docker æœåŠ¡å™¨è¿è¡Œ
- æµ‹è¯•ä¼šè‡ªåŠ¨å¤„ç†ç«¯å£å†²çªå’Œèµ„æºæ¸…ç†
- åŒ…å«è¶…æ—¶ä¿æŠ¤æœºåˆ¶ï¼Œé¿å…æµ‹è¯•å¡ä½

### 5. åè®®å¤„ç† (`utils/protocol.test.ts`) - 17 ä¸ªæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- âœ… åè®®æ£€æµ‹ï¼ˆRTMPã€HLSã€FLVã€WebRTCã€DASHï¼‰
- âœ… åè®®éªŒè¯ï¼ˆæœ‰æ•ˆåè®®å’Œæ— æ•ˆåè®®ï¼‰
- âœ… URL è§£æï¼ˆRTMPã€HLSï¼‰
- âœ… é»˜è®¤ç«¯å£è·å–
- âœ… åè®®èƒ½åŠ›åˆ¤æ–­ï¼ˆæ¨æµã€æ‹‰æµï¼‰

**æµ‹è¯•ç»“æœ**: 17 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### 6. è¿æ¥æ±  (`utils/connection-pool.test.ts`) - 6 ä¸ªæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- âœ… æ”¯æŒåŸºæœ¬æ“ä½œï¼ˆè·å–è¿æ¥ã€é‡Šæ”¾è¿æ¥ï¼‰
- âœ… å¤ç”¨è¿æ¥ï¼ˆç›¸åŒ URL å¤ç”¨åŒä¸€è¿æ¥ï¼‰
- âœ… é™åˆ¶è¿æ¥æ•°ï¼ˆmaxConnectionsï¼‰
- âœ… æ”¯æŒé‡Šæ”¾è¿æ¥
- âœ… æä¾›ç»Ÿè®¡ä¿¡æ¯ï¼ˆtotalã€activeã€idleï¼‰
- âœ… åœ¨ stop æ—¶æ¸…ç†æ‰€æœ‰è¿æ¥

**æµ‹è¯•ç»“æœ**: 6 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

**æ€§èƒ½**: æ¯ä¸ªæµ‹è¯•çº¦ 150-160msï¼ˆåŒ…å«å®šæ—¶å™¨æ¸…ç†ç­‰å¾…ï¼‰

### 7. é‡è¿ç®¡ç†å™¨ (`utils/reconnect.test.ts`) - 5 ä¸ªæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- âœ… æ”¯æŒåŸºæœ¬é‡è¿æ“ä½œ
- âœ… åœ¨è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°æ—¶æŠ›å‡ºé”™è¯¯
- âœ… å®ç°æŒ‡æ•°é€€é¿ç­–ç•¥
- âœ… æ”¯æŒé‡ç½®æ“ä½œ
- âœ… æ”¯æŒåœæ­¢æ“ä½œ

**æµ‹è¯•ç»“æœ**: 5 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

**æ€§èƒ½**: åŸºæœ¬é‡è¿æµ‹è¯•çº¦ 714msï¼ˆåŒ…å«é‡è¯•å»¶è¿Ÿï¼‰

### 8. æ‰¹é‡æ“ä½œ (`utils/batch-operations.test.ts`) - 7 ä¸ªæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- âœ… æ”¯æŒåŸºæœ¬æ‰¹é‡å¤„ç†
- âœ… æ”¯æŒé”™è¯¯å¤„ç†ï¼ˆcontinueOnErrorï¼‰
- âœ… åœ¨ä¸ç»§ç»­é”™è¯¯æ—¶æŠ›å‡ºå¼‚å¸¸
- âœ… æ§åˆ¶å¹¶å‘æ•°ï¼ˆconcurrencyï¼‰
- âœ… æ‰¹é‡åˆ›å»ºæµ
- âœ… æ‰¹é‡åˆ é™¤æµ
- âœ… æ‰¹é‡è·å–æµ

**æµ‹è¯•ç»“æœ**: 7 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## âš¡ æ€§èƒ½æŒ‡æ ‡

- **æ€»æµ‹è¯•æ‰§è¡Œæ—¶é—´**: ~11 ç§’
- **å¹³å‡æ¯ä¸ªæµ‹è¯•**: ~92ms
- **æœ€æ…¢æµ‹è¯•**: é‡è¿ç®¡ç†å™¨åŸºæœ¬é‡è¿æ“ä½œï¼ˆ714msï¼ŒåŒ…å«é‡è¯•å»¶è¿Ÿï¼‰
- **æœ€å¿«æµ‹è¯•**: å¤§éƒ¨åˆ†å·¥å…·å‡½æ•°æµ‹è¯•ï¼ˆ< 1msï¼‰

---

## âœ… æµ‹è¯•è´¨é‡

### è¦†ç›–èŒƒå›´
- âœ… **æ ¸å¿ƒåŠŸèƒ½**: æµç®¡ç†ã€æˆ¿é—´ç®¡ç†ã€é€‚é…å™¨
- âœ… **é›†æˆæµ‹è¯•**: æµç”Ÿå‘½å‘¨æœŸã€è§†é¢‘æ–‡ä»¶æ¨æµ
- âœ… **å·¥å…·å‡½æ•°**: é”™è¯¯å¤„ç†ã€åè®®å¤„ç†ã€URL ç”Ÿæˆã€çŠ¶æ€ç®¡ç†ã€ID ç”Ÿæˆã€ç¼“å­˜ã€é˜Ÿåˆ—ã€è¿æ¥æ± ã€é‡è¿ç®¡ç†ã€æ‰¹é‡æ“ä½œ
- âœ… **é”™è¯¯å¤„ç†**: æ‰€æœ‰é”™è¯¯ç±»å‹éƒ½æœ‰æµ‹è¯•è¦†ç›–
- âœ… **è¾¹ç•Œæƒ…å†µ**: ä¸å­˜åœ¨çš„æµã€æ— æ•ˆåè®®ã€è¶…æ—¶å¤„ç†ç­‰

### æµ‹è¯•ç¨³å®šæ€§
- âœ… æ‰€æœ‰æµ‹è¯•éƒ½èƒ½ç¨³å®šé€šè¿‡
- âœ… åŒ…å«èµ„æºæ¸…ç†æœºåˆ¶ï¼ˆç«¯å£é‡Šæ”¾ã€è¿›ç¨‹ç»ˆæ­¢ï¼‰
- âœ… åŒ…å«è¶…æ—¶ä¿æŠ¤æœºåˆ¶ï¼Œé¿å…æµ‹è¯•å¡ä½
- âœ… æ”¯æŒå¹¶å‘æµ‹è¯•æ‰§è¡Œ

---

## ğŸ¯ æµ‹è¯•ç¯å¢ƒ

- **æµ‹è¯•æ¡†æ¶**: @dreamer/test@^1.0.0-beta.13
- **è¿è¡Œæ—¶**: Deno 2.6.4+ / Bun 1.3.5
- **å¤–éƒ¨ä¾èµ–**:
  - SRS Docker æœåŠ¡å™¨ï¼ˆç”¨äºè§†é¢‘æ–‡ä»¶æ¨æµæµ‹è¯•ï¼‰
  - FFmpegï¼ˆç”¨äºè§†é¢‘æ–‡ä»¶æ¨æµæµ‹è¯•ï¼‰

---

## ğŸ“ æµ‹è¯•è¯´æ˜

### é›†æˆæµ‹è¯•è¦æ±‚

**è§†é¢‘æ–‡ä»¶æ¨æµæµ‹è¯•** (`integration/video-file-publish.test.ts`) éœ€è¦ï¼š
1. SRS Docker æœåŠ¡å™¨è¿è¡Œï¼ˆç«¯å£ 1935ã€8080ã€1985ï¼‰
2. æµ‹è¯•è§†é¢‘æ–‡ä»¶å­˜åœ¨ï¼ˆ`tests/data/test.mp4`ï¼‰

**å¯åŠ¨ SRS æœåŠ¡å™¨**:
```bash
docker run -d \
  -p 1935:1935 \
  -p 8080:8080 \
  -p 1985:1985 \
  --name srs \
  ossrs/srs:latest
```

### æµ‹è¯•éš”ç¦»

- æ¯ä¸ªæµ‹è¯•éƒ½ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•
- æµ‹è¯•ç»“æŸåè‡ªåŠ¨æ¸…ç†èµ„æºï¼ˆæµã€æˆ¿é—´ã€è¿æ¥ã€è¿›ç¨‹ï¼‰
- ç«¯å£è‡ªåŠ¨é‡Šæ”¾ï¼Œé¿å…ç«¯å£å†²çª

### è¶…æ—¶ä¿æŠ¤

- è§†é¢‘æ–‡ä»¶æ¨æµæµ‹è¯•åŒ…å«è¶…æ—¶ä¿æŠ¤ï¼ˆ5 ç§’ï¼‰
- FFmpeg è¿›ç¨‹åœæ­¢åŒ…å«è¶…æ—¶ä¿æŠ¤ï¼ˆ3 ç§’ï¼‰
- Socket.IO æœåŠ¡å™¨å…³é—­åŒ…å«è¶…æ—¶ä¿æŠ¤ï¼ˆ2 ç§’ï¼‰

---

## ğŸš€ è¿è¡Œæµ‹è¯•

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
deno test -A tests/
```

### è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
```bash
deno test -A tests/manager.test.ts
```

### è¿è¡Œé›†æˆæµ‹è¯•ï¼ˆéœ€è¦ SRS æœåŠ¡å™¨ï¼‰
```bash
deno test -A tests/integration/
```

---

## ğŸ“Š æµ‹è¯•æ€»ç»“

âœ… **æ‰€æœ‰ 184 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡**
- æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ï¼ˆæµç®¡ç†ã€é€‚é…å™¨ã€å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ï¼‰
- å·¥å…·å‡½æ•°æµ‹è¯•
- é›†æˆæµ‹è¯•

**æµ‹è¯•è¦†ç›–**:
- âœ… æµç®¡ç†ï¼ˆåˆ›å»ºã€è·å–ã€åˆ é™¤ã€åˆ—è¡¨ï¼‰
- âœ… æˆ¿é—´ç®¡ç†ï¼ˆåˆ›å»ºã€è·å–ã€åˆ é™¤ã€åˆ—è¡¨ï¼‰
- âœ… é€‚é…å™¨ï¼ˆFFmpegï¼‰
- âœ… åè®®å¤„ç†ï¼ˆRTMPã€HLSã€FLVã€WebRTCã€DASHï¼‰
- âœ… URL ç”Ÿæˆï¼ˆæ¨æµã€æ‹‰æµï¼‰
- âœ… çŠ¶æ€ç®¡ç†ï¼ˆçŠ¶æ€è½¬æ¢ã€çŠ¶æ€éªŒè¯ï¼‰
- âœ… é”™è¯¯å¤„ç†ï¼ˆæ‰€æœ‰é”™è¯¯ç±»å‹ï¼‰
- âœ… ç¼“å­˜ï¼ˆLRUã€æµç¼“å­˜ï¼‰
- âœ… é˜Ÿåˆ—ï¼ˆæ•°æ®é˜Ÿåˆ—ï¼‰
- âœ… è¿æ¥æ± ï¼ˆè¿æ¥å¤ç”¨ã€é™åˆ¶ï¼‰
- âœ… é‡è¿ç®¡ç†ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
- âœ… æ‰¹é‡æ“ä½œï¼ˆæ‰¹é‡åˆ›å»ºã€åˆ é™¤ã€è·å–ï¼‰
- âœ… è§†é¢‘æ–‡ä»¶æ¨æµï¼ˆå¾ªç¯æ’­æ”¾ã€è´¨é‡è®¾ç½®ï¼‰

**æµ‹è¯•è´¨é‡**: â­â­â­â­â­ (5/5)

---

*æœ€åæ›´æ–°: 2026-01-29*
